!function(){"use strict";var a="lambConfig",b={NONE:"None",NORMAL:"Normal",VERBOSE:"Verbose"};b.all=[b.NONE,b.NORMAL,b.VERBOSE],angular.module("apLamb",[]),angular.module("apLamb").run(["$q","$rootScope","lambConfigService",function(a,b,c){angular.isPromise||(angular.isPromise=function(b){return b&&b.then&&String(b.then)===String(a(function(a,b){a()}).then)}),angular.isScope||(angular.isScope=function(a){return a&&a.$digest&&String(a.$digest)===String(b.$digest)})}]),angular.module("apLamb").factory("lambConfigService",["$injector",function(c){function d(){return h}function e(){return i}function f(){var b;h="None",c.has(a)&&(b=c.get(a),b.logLevel&&g(b.logLevel),i=b.socks)}function g(c){var d,e,f,g=c?c.toLowerCase():"";for(f=0;f<b.all.length;++f)if(d=b.all[f],g===d.toLowerCase())return void(h=d);for(e="Illegal "+a+".logLevel '"+c+"' - Valid values are ",f=0;f<b.all.length;++f)f>0&&(e+=f<b.all.length-1?", ":" and "),e+="'"+b.all[f]+"'";throw new Error(e)}var h,i=[];return f(),{LAMB_CONFIG_NAME:a,LogLevelEnum:b,getLogLevel:d,setLogLevel:g,getSocks:e}}])}(),function(){"use strict";function a(a,b){this.data=b,this.publisher=a}function b(a,b,c,d){this.publisherId=a.publisherId,this.publisherTopic=a.topic,this.subscriberId=b.subscriberId,this.subscriberTopic=b.topic,this.topicMatches=c,this.data=d}function c(a,b){this.publisherId=a,this.subtopics=b.split("."),this.topic=b}function d(a,b,c){this.callbackFn=c,this.subscriberId=b,this.subtopics=a.split("."),this.topic=a}angular.module("apLamb").factory("Lamb",["$log","$rootScope","lambConfigService",function(e,f,g){function h(a){g.getLogLevel()===g.LogLevelEnum.VERBOSE&&(e.debug("lamb: "+a.publisher.publisherId+" publishes '"+a.publisher.topic+"'"),e.debug("lamb data: "+JSON.stringify(a.data))),f.$broadcast(n,a)}function i(a){var b,c;for(b=0;b<m.length;++b)if(c=m[b],c.subscriberId===a.subscriberId&&c.topic===a.topic)return;g.getLogLevel()===g.LogLevelEnum.VERBOSE&&e.info("lamb: "+a.subscriberId+"subscribes to '"+a.topic+"'"),m.push(a)}function j(a){g.getLogLevel()===g.LogLevelEnum.VERBOSE&&e.info("lamb: "+a+" unsubscribes from all topics"),k(null,a)}function k(a,b){var c=[];angular.forEach(m,function(d){(d.subscriberId!=b||d.subscriberId===b&&a&&a!==d.topic)&&c.push(d)}),g.getLogLevel()===g.LogLevelEnum.VERBOSE&&c.length!==m.length&&e.info("lamb: "+b+"unsubscribes '"+a+"'"),m=c}function l(a,b){if(!a)throw new Error("clientName cannot be null or empty.");if(b&&!angular.isScope(b))throw new Error("2nd argument is not a scope.");var c=this instanceof l?this:Object.create(l.prototype),d=b||f.$new(!0),e=d.$parent;return c.clientId=a+(e?"("+d.$id+")":""),b&&e&&b.$on("$destroy",function(){c.dispose()}),d||d.$destroy(),c}var m=[],n="$$LAMB$$";return f.$on(n,function(a,c){var d,f=0;angular.forEach(m,function(a){a.subscriberId!==c.publisher.publisherId&&(d=c.getTopicMatches(c.publisher,a),d&&(g.getLogLevel()===g.LogLevelEnum.VERBOSE&&e.debug("lamb: "+a.subscriberId+" subscriber called for '"+a.topic+"'"),a.callbackFn(c.data,new b(c.publisher,a,d,c.data)),++f))}),g.getLogLevel()===g.LogLevelEnum.NORMAL&&e.debug("lamb: topic '"+c.publisher.topic+"', publisher '"+c.publisher.publisherId+"', "+f+" subscribers"),0===f&&g.getLogLevel()===g.LogLevelEnum.VERBOSE&&e.debug("lamb: no subscribers for '"+c.publisher.topic+"'")}),l.prototype={dispose:function(){this.clientId&&(j(this.clientId),this.clientId=null)},publish:function(b,d){var e,f;if(this.clientId){if(!b)throw new Error("topic cannot be null or empty");f=new c(this.clientId,b),e=new a(f,d),h(e)}},subscribe:function(a,b){var c;if(this.clientId){if(!a)throw new Error("topic cannot be null or empty");c=new d(a,this.clientId,b),i(c)}},unsubscribe:function(a){if(this.clientId){if(!a)throw new Error("topic cannot be null or empty");k(a,this.clientId)}}},l}]),a.prototype.getTopicMatches=function(a,b){function c(a,b){return b<a.length?a[b]:"*"===a[a.length-1]?"*":void 0}function d(a,b){return a&&b?"*"===a||"*"===b?!0:a===b:!1}var e,f,g,h,i;for(h=Math.max(a.subtopics.length,b.subtopics.length),i=[],e=0;h>e;++e){if(f=c(a.subtopics,e),g=c(b.subtopics,e),!d(f,g))return null;i.push("*"!==f?f:g)}return i},b.prototype.getSubtopic=function(a,b){return this.topicMatches&&this.topicMatches.length>a?this.topicMatches[a]:b}}();