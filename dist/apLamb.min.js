!function(){"use strict";var a="lambConfig",b={NONE:"None",NORMAL:"Normal",VERBOSE:"Verbose"};b.all=[b.NONE,b.NORMAL,b.VERBOSE],angular.module("apLamb",[]),angular.module("apLamb").run(["$q","$rootScope","lambConfigService",function(a,b,c){angular.isPromise||(angular.isPromise=function(b){return b&&b.then&&String(b.then)===String(a(function(a,b){a()}).then)}),angular.isScope||(angular.isScope=function(a){return a&&a.$digest&&String(a.$digest)===String(b.$digest)})}]),angular.module("apLamb").factory("lambConfigService",["$injector",function(c){function d(){return h}function e(){return i}function f(){var b;h="None",c.has(a)&&(b=c.get(a),b.logLevel&&g(b.logLevel),i=b.socks)}function g(c){var d,e,f,g=c?c.toLowerCase():"";for(f=0;f<b.all.length;++f)if(d=b.all[f],g===d.toLowerCase())return void(h=d);for(e="Illegal "+a+".logLevel '"+c+"' - Valid values are ",f=0;f<b.all.length;++f)f>0&&(e+=f<b.all.length-1?", ":" and "),e+="'"+b.all[f]+"'";throw new Error(e)}var h,i=[];return f(),{LAMB_CONFIG_NAME:a,LogLevelEnum:b,getLogLevel:d,setLogLevel:g,getSocks:e}}])}(),function(){"use strict";function a(a,b){this.data=b,this.publisher=a}function b(a,b,c,d){this.publisherId=a.publisherId,this.publisherTopic=a.topic,this.subscriberId=b.subscriberId,this.subscriberTopic=b.topic,this.topicMatches=c,this.data=d}function c(a,b){this.publisherId=a,this.topic=b}function d(a,b,c){this.callbackFn=c,this.subscriberId=b,this.topic=a}function e(a){this.captured=[],this.current=a.split("."),this.topicString=a}angular.module("apLamb").factory("Lamb",["$log","$rootScope","lambConfigService",function(f,g,h){function i(a){h.getLogLevel()===h.LogLevelEnum.VERBOSE&&(f.debug("lamb: "+a.publisher.publisherId+" publishes '"+a.publisher.topic+"'"),f.debug("lamb data: "+JSON.stringify(a.data))),g.$broadcast(o,a)}function j(a){var b,c;for(b=0;b<n.length;++b)if(c=n[b],c.subscriberId===a.subscriberId&&c.topic===a.topic)return;h.getLogLevel()===h.LogLevelEnum.VERBOSE&&f.info("lamb: "+a.subscriberId+"subscribes to '"+a.topic+"'"),n.push(a)}function k(a){h.getLogLevel()===h.LogLevelEnum.VERBOSE&&f.info("lamb: "+a+" unsubscribes from all topics"),l(null,a)}function l(a,b){var c=[];angular.forEach(n,function(d){(d.subscriberId!=b||d.subscriberId===b&&a&&a!==d.topic)&&c.push(d)}),h.getLogLevel()===h.LogLevelEnum.VERBOSE&&c.length!==n.length&&f.info("lamb: "+b+"unsubscribes '"+a+"'"),n=c}function m(a,b){if(!a)throw new Error("clientName cannot be null or empty.");if(b&&!angular.isScope(b))throw new Error("2nd argument is not a scope.");var c=this instanceof m?this:Object.create(m.prototype),d=b||g.$new(!0),e=d.$parent;return c.clientId=a+(e?"("+d.$id+")":""),b&&e&&b.$on("$destroy",function(){c.dispose()}),d||d.$destroy(),c}var n=[],o="$$LAMB$$";return g.$on(o,function(a,c){var d=0,g=new e(c.publisher.topic);angular.forEach(n,function(a){var i;a.subscriberId!==c.publisher.publisherId&&(i=new e(a.topic),e.isMatch(g,i)&&(h.getLogLevel()===h.LogLevelEnum.VERBOSE&&f.debug("lamb: "+a.subscriberId+" subscriber called for '"+a.topic+"'"),a.callbackFn(c.data,new b(c.publisher,a,g.hasWild()&&!i.hasWild()?e.result.topic1.captured:e.result.topic2.captured,c.data)),++d))}),h.getLogLevel()===h.LogLevelEnum.NORMAL&&f.debug("lamb: topic '"+c.publisher.topic+"', publisher '"+c.publisher.publisherId+"', "+d+" subscribers"),0===d&&h.getLogLevel()===h.LogLevelEnum.VERBOSE&&f.debug("lamb: no subscribers for '"+c.publisher.topic+"'")}),m.prototype={dispose:function(){this.clientId&&(k(this.clientId),this.clientId=null)},publish:function(b,d){var e,f;if(this.clientId){if(!b)throw new Error("topic cannot be null or empty");f=new c(this.clientId,b),e=new a(f,d),i(e)}},subscribe:function(a,b){var c;if(this.clientId){if(!a)throw new Error("topic cannot be null or empty");c=new d(a,this.clientId,b),j(c)}},unsubscribe:function(a){if(this.clientId){if(!a)throw new Error("topic cannot be null or empty");l(a,this.clientId)}}},m}]),b.prototype.getSubtopic=function(a,b){return this.topicMatches&&this.topicMatches.length>a?this.topicMatches[a]:b},e.prototype={advance:function(a,b){var c;if(!this.atEnd())for(this.captured.push(a),c=0;(b||1)>c;++c)this.current.shift()},clone:function(){var a=new e(this.topicString);return a.captured=this.captured.slice(),a.current=this.current.slice(),a},atEnd:function(){return 0===this.current.length},currentItem:function(a){var b,c="";if(a=a||1,this.current.length<a)return null;for(b=0;a>b;++b)c.length>0&&(c+="."),c+=this.current[b];return c},hasWild:function(){return-1!==this.topicString.indexOf("*")},isCurrentWild:function(){return!this.atEnd()&&"*"===this.current[0]},wildCandidateCount:function(){var a,b=0;for(a=0;a<this.current.length;++a){if(a>0&&"*"===this.current[a])return b;++b}return b}},e.isMatch=function(a,b){var c,d,f,g;return a.hasWild||b.hasWild?a.atEnd()&&b.atEnd()?(e.result={topic1:a,topic2:b},!0):a.isCurrentWild()||b.isCurrentWild()?a.isCurrentWild()&&e.wildMatch(a,b,!1)||b.isCurrentWild()&&e.wildMatch(b,a,!0):(c=a.currentItem(),d=b.currentItem(),c!==d?!1:(f=a.clone(),g=b.clone(),f.advance(d),g.advance(c),e.isMatch(f,g))):a.topicString===b.topicString},e.wildMatch=function(a,b,c){var d,f,g,h,i;if(!a.isCurrentWild())throw new Error("Internal error: Topic.wildMatch must have wild LHS");for(d=1;d<=b.wildCandidateCount();++d){if(h=a.clone(),i=b.clone(),f=h.currentItem(),g=i.currentItem(d),h.advance(g),i.advance(f,d),!c&&e.isMatch(h,i))return!0;if(c&&e.isMatch(i,h))return!0}return!1}}();